{% extends "base.html" %}
{% load static %}

{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="overlay"></div>
<div class="container">
    <div class="row">
        <div class="col">
            <hr>
            <h2 class="logo-font mb-4">Order Confirmation</h2>
            <hr>
        </div>
    </div>

    <div class="row">
        <div class="col-12 col-lg-7">
            <div class="alert alert-success" role="alert">
                <h4 class="alert-heading">
                    <i class="fa fa-check-circle"></i> Order Confirmed!
                </h4>
                <p>Thank you for your order! Your order <strong>{{ order.order_number }}</strong> has been successfully placed.</p>
                <hr>
                <p class="mb-0">A confirmation email has been sent to <strong>{{ order.email }}</strong></p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Order Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Order Information</h6>
                            <p class="mb-1"><strong>Order Number:</strong> {{ order.order_number }}</p>
                            <p class="mb-1"><strong>Order Date:</strong> {{ order.date|date:"F d, Y \a\t g:i A" }}</p>
                            <p class="mb-1"><strong>Status:</strong> 
                                <span class="badge {{ order.get_status_display_badge }}">{{ order.get_status_display }}</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6>Customer Information</h6>
                            <p class="mb-1"><strong>Name:</strong> {{ order.full_name }}</p>
                            <p class="mb-1"><strong>Email:</strong> {{ order.email }}</p>
                            {% if order.phone_number %}
                                <p class="mb-1"><strong>Phone:</strong> {{ order.phone_number }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">Delivery Address</h5>
                </div>
                <div class="card-body">
                    <address>
                        {{ order.full_name }}<br>
                        {{ order.street_address1 }}<br>
                        {% if order.street_address2 %}
                            {{ order.street_address2 }}<br>
                        {% endif %}
                        {{ order.town_or_city }}{% if order.county %}, {{ order.county }}{% endif %}<br>
                        {% if order.postcode %}{{ order.postcode }}<br>{% endif %}
                        {{ order.country.name }}
                    </address>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-5">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Order Summary</h5>
                </div>
                <div class="card-body">
                    {% for item in order_summary.items %}
                        <div class="row mb-2">
                            <div class="col-8">
                                <p class="mb-0"><strong>{{ item.product.name }}</strong></p>
                                {% if item.size %}
                                    <small class="text-muted">Size: {{ item.size.display_name }}</small><br>
                                {% endif %}
                                <small class="text-muted">Qty: {{ item.quantity }} × €{{ item.product.price|floatformat:2 }}</small>
                            </div>
                            <div class="col-4 text-right">
                                <p class="mb-0">€{{ item.lineitem_total|floatformat:2 }}</p>
                            </div>
                        </div>
                        {% if not forloop.last %}<hr class="my-2">{% endif %}
                    {% endfor %}
                    
                    <hr>
                    <div class="row">
                        <div class="col-8">
                            <p class="mb-1">Subtotal:</p>
                            <p class="mb-1">Delivery:</p>
                            <p class="mb-0"><strong>Total:</strong></p>
                        </div>
                        <div class="col-4 text-right">
                            <p class="mb-1">€{{ order.order_total|floatformat:2 }}</p>
                            <p class="mb-1">€{{ order.delivery_cost|floatformat:2 }}</p>
                            <p class="mb-0"><strong>€{{ order.grand_total|floatformat:2 }}</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <a href="{% url 'categories' %}" class="btn btn-secondary btn-lg btn-block">
                    <i class="fa fa-chevron-left mr-2"></i>
                    Continue Shopping
                </a>
                
                {% if user.is_authenticated %}
                    <a href="{% url 'orders:order_history' %}" class="btn btn-primary btn-lg btn-block mt-2">
                        <i class="fa fa-list mr-2"></i>
                        View Order History
                    </a>
                {% endif %}
                
                <a href="{% url 'orders:order_tracking' %}" class="btn btn-primary btn-lg btn-block mt-2">
                    <i class="fa fa-search mr-2"></i>
                    Track This Order
                </a>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col">
            <div class="alert alert-info" role="alert">
                <h6><i class="fa fa-info-circle"></i> What's Next?</h6>
                <ul class="mb-0">
                    <li>You will receive an email confirmation shortly</li>
                    <li>Your order will be processed within 1-2 business days</li>
                    <li>You'll receive a shipping notification with tracking information</li>
                    <li>Delivery typically takes 3-5 business days</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Fix icon sizes on mobile to prevent overlap */
    @media (max-width: 768px) {
        .alert-heading i {
            font-size: 1.2rem !important;
            margin-right: 0.5rem;
        }
        
        .alert-info h6 i {
            font-size: 1rem !important;
            margin-right: 0.25rem;
        }
        
        .btn i {
            font-size: 0.9rem !important;
        }
        
        /* Ensure proper spacing for mobile */
        .alert-heading {
            font-size: 1.3rem;
            line-height: 1.4;
        }
        
        .card-header h5 {
            font-size: 1.1rem;
        }
    }
    
    /* General icon size improvements */
    .fa {
        vertical-align: middle;
    }
</style>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script type="text/javascript">
    // Auto-refresh order status every 30 seconds
    setInterval(function() {
        fetch(`/orders/ajax/status/{{ order.order_number }}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.status !== '{{ order.status }}') {
                    location.reload();
                }
            })
            .catch(error => console.log('Status check failed:', error));
    }, 30000);
</script>
{% endblock %}